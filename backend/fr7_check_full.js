const knex = require('knex')(require('./knexfile').development); async function analyze() { console.log('--- FR7 Analysis ---'); try { const hasChapters = await knex.schema.hasTable('chapters'); console.log('Chapters Table: ' + hasChapters); if (hasChapters) { const cols = await knex('chapters').columnInfo(); console.log('Chapters Columns: ' + Object.keys(cols).join(', ')); } const hasRoles = await knex.schema.hasTable('roles'); console.log('Roles Table: ' + hasRoles); const usersCols = await knex('users').columnInfo(); console.log('Users Columns: ' + Object.keys(usersCols).join(', ')); if (usersCols.role) { console.log('Users table has role column.'); const roles = await knex('users').distinct('role'); console.log('Distinct roles: ' + JSON.stringify(roles)); } else { console.log('Users table MISSING role column.'); } const hasLogs = await knex.schema.hasTable('activity_logs'); console.log('Activity Logs Table: ' + hasLogs); if (hasLogs) { const cols = await knex('activity_logs').columnInfo(); console.log('Activity Logs Columns: ' + Object.keys(cols).join(', ')); } if (usersCols.language || usersCols.locale) { console.log('Localization column found in users.'); } else { console.log('Localization column MISSING in users.'); } } catch (e) { console.error(e); } finally { knex.destroy(); } } analyze();
